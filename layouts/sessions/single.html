<!DOCTYPE html>
<html lang="en">
{{ partial "head.html" . }}

<body class="antialiased">

{{ partial "navigation.html" . }}

<main class="mt-20">

{{ $event := "" }}
{{ if (isset .Params "event") }}
  {{ $event = (.GetPage (print "/events/" .Params.event)) }}
{{ else }}
  {{ $eventArr := slice .Page.File.TranslationBaseName }}
  {{ $events := where .Site.RegularPages ".Params.sessions" "intersect" $eventArr }}
  {{ $event = (index $events 0) }}
{{ end }}

<main class="mt-20">
  <header class="container px-6 mx-auto">
    <h1 class="max-w-4xl mb-4 text-5xl font-semibold leading-tight tracking-tight">{{.Title}}</h1>
  </header>

  {{ with .Params.recordings }}
    {{ with .vimeo }}
    {{ $vimeo_embed :=  delimit (last 1 (split .url "/")) "" }}
    <div class='embed-container'><iframe src='https://player.vimeo.com/video/{{ $vimeo_embed }}' frameborder='0' allowFullScreen></iframe></div>
    <p><em>You can also view the <a href="{{ $.Params.Recordings.crowdcast.url }}" target="_blank">full event recording on Crowdcast</a>. This session starts at {{$.Params.Recordings.crowdcast.start_time}}.</em></p>
    {{ else }}
    <p><em>This event was recorded on Crowdcast. We're working on editing the recording, but until then you can view the full recording on Crowdcast by clicking the button below.</em></p>
    {{ if ne .crowdcast.start_time "00:00"}}<p><em>This session starts at {{.crowdcast.start_time}} in the recording.</em></p>{{ end }}
    <p><input type="button" class="btn btn-lg btn-color btn-button" value="Open Crowdcast Recording"  onclick=" window.open('{{ .crowdcast.url }}','_blank')"></p>
    {{ end }}
  {{ end }}

{{ .Content }}

<p>
  <a href="{{ $event.Permalink }}#schedule"> See the full event listing </a>
</p>

{{ if ne .Params.sessions nil }}
  <div class="space-y-10">
    {{ range $session := .Params.sessions }}

      {{ with site.GetPage (print "/sessions/" $session) }}
        {{ $.Scratch.Set "speakers" .Params.speakers }}
      {{ end }}

      {{ $speakers := $.Scratch.Get "speakers" }}
      {{ range $speaker := $speakers }}
        {{ with site.GetPage (print "/speakers/" $speaker) }}
          {{ partial "speaker-card.html" .}}
        {{ end }}
      {{end}}
    {{ end }}
  </div>
{{ end }}
</main>

{{ partial "footer.html" .}}

{{ partial "scripts.html" .}}

</body>
</html>
